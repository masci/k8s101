<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Deployments - k8s101</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">k8s101</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Course units <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../010-first-contact/" class="dropdown-item">First contact</a>
</li>
                                    
<li>
    <a href="../020-pods/" class="dropdown-item">Pods</a>
</li>
                                    
<li>
    <a href="../030-declarative/" class="dropdown-item">Going declarative</a>
</li>
                                    
<li>
    <a href="../040-labels/" class="dropdown-item">Labels</a>
</li>
                                    
<li>
    <a href="../050-annotations/" class="dropdown-item">Annotations</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Deployments</a>
</li>
                                    
<li>
    <a href="../070-services/" class="dropdown-item">Services</a>
</li>
                                    
<li>
    <a href="../080-ingress/" class="dropdown-item">Ingress</a>
</li>
                                    
<li>
    <a href="../090-configmaps/" class="dropdown-item">Config Maps</a>
</li>
                                    
<li>
    <a href="../100-secrets/" class="dropdown-item">Secrets</a>
</li>
                                    
<li>
    <a href="../110-helm/" class="dropdown-item">Helm</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../050-annotations/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../070-services/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/masci/k8s101/edit/master/docs/060-deployments.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#deployments" class="nav-link">Deployments</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#exercise-n1-manage-a-deployment" class="nav-link">Exercise n.1: manage a deployment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="deployments">Deployments</h1>
<p>So far we scheduled our pods manually but this way we don't leverage any of the
cool features of Kubernetes, like scaling up and down automatically or self-healing
the system when needed.</p>
<p>A <strong>Deployment</strong> is an object that logically groups pods together according to our
specifications. An example of specification is the number of desired pods that must
run at any given time no matter what. If a pod dies, we want Kubernetes to bring another
one up to replace it; if pods are more than we asked for, we want Kubernetes to
kill as many as needed to match our request.</p>
<h2 id="exercise-n1-manage-a-deployment">Exercise n.1: manage a deployment</h2>
<blockquote>
<p>Change directory into the folder <code>definitions</code> before running these commands.</p>
</blockquote>
<p>Create a <strong>Deployment</strong> called <code>nginx-prod</code>:</p>
<pre><code class="sh">$ kubectl apply -f nginx-prod.yaml
deployment.apps/nginx-prod created
</code></pre>

<p>Now let's ask <code>kubectl</code> to list all the objects present in the cluster to see
what happened:</p>
<pre><code class="sh">$ kubectl get all
NAME                             READY   STATUS    RESTARTS   AGE
pod/nginx-prod-d6fd669f4-8tng2   1/1     Running   0          102s
pod/nginx-prod-d6fd669f4-9x57t   1/1     Running   0          102s
pod/nginx-prod-d6fd669f4-fpxqw   1/1     Running   0          102s

NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx-prod   3/3     3            3           102s

NAME                                   DESIRED   CURRENT   READY   AGE
replicaset.apps/nginx-prod-d6fd669f4   3         3         3       102s
</code></pre>

<p>As you can see there are now 3 pods, 1 deployment and 1 object we haven't seen
yet, a <strong>Replicaset</strong>. A replicaset has the only responsibility to keep a certain
number of pods running at any time; in this case, since our deployment specs
defined 3 replicas for our pod, while creating the deployment Kubernetes
also attached a replicaset to it.</p>
<p>If you run a <code>kubectl describe</code> on the replicaset, you'll notice that it is under the
control of our deployment:</p>
<pre><code class="sh">$ kubectl describe replicaset &lt;the name of the replicaset&gt;
Name:           nginx-prod-d6fd669f4
Namespace:      default
&lt;snip&gt;
Controlled By:  Deployment/nginx-prod
&lt;snip&gt;
</code></pre>

<p>Now let's see the replicaset in action: we're going to kill one pod and see if
another one starts to take its place.</p>
<pre><code class="sh">$ kubectl delete pod &lt;the name of the pod&gt;
pod &quot;the name of the pod&quot; deleted
</code></pre>

<p>Respawning a new pod is almost instantaneous, so by the time you run this
command again:</p>
<pre><code class="sh">kubectl get pods
</code></pre>

<p>you'll see that a new pod with a different name has started, bringing back
the pod count to 3.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
