<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Ingress - k8s101</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">k8s101</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Course units <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../010-first-contact/" class="dropdown-item">First contact</a>
</li>
                                    
<li>
    <a href="../020-pods/" class="dropdown-item">Pods</a>
</li>
                                    
<li>
    <a href="../030-declarative/" class="dropdown-item">Going declarative</a>
</li>
                                    
<li>
    <a href="../040-labels/" class="dropdown-item">Labels</a>
</li>
                                    
<li>
    <a href="../050-annotations/" class="dropdown-item">Annotations</a>
</li>
                                    
<li>
    <a href="../060-deployments/" class="dropdown-item">Deployments</a>
</li>
                                    
<li>
    <a href="../070-services/" class="dropdown-item">Services</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Ingress</a>
</li>
                                    
<li>
    <a href="../090-configmaps/" class="dropdown-item">Config Maps</a>
</li>
                                    
<li>
    <a href="../100-secrets/" class="dropdown-item">Secrets</a>
</li>
                                    
<li>
    <a href="../110-helm/" class="dropdown-item">Helm</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../070-services/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../090-configmaps/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/masci/k8s101/tree/master/src/080-ingress.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#ingress" class="nav-link">Ingress</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#exercise-n1-deploy-an-ingress-controller" class="nav-link">Exercise n.1: deploy an ingress controller</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#exercise-n2" class="nav-link">Exercise n.2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="ingress">Ingress</h1>
<p>In Kubernetes, an <strong>Ingress</strong> is an object that allows access to your Kubernetes
services from outside the Kubernetes cluster.</p>
<p>You might say this is also true for deployments exposed through a service of type
<code>LoadBalancer</code>, but there's a big difference: an ingress is not tied to any
particular service.</p>
<p>Similarly to “virtual hosts” on a traditional HTTP server, Kubernetes can use an
ingress as an HTTP-based load balancer to “inspect” the requests and route them
to the right service depending on user's configuration.</p>
<p>An ingress usually consists of an application called <em>Ingress Controller</em> deployed
in the cluster itself. It's important to remember that Kubernetes doesn't ship any
Ingress Controller out of the box, so you will always need to install this additional
component behind an <strong>Ingress</strong> object. There is plenty of Ingress Controllers
available on the market: Nginx, Traefik, Ambassador just to name a few, so you can
pick the one that better suits your use case.</p>
<p>For the scope of this course, we'll see how to deploy Nginx as an Ingress Controller
for our local tiny cluster.</p>
<h2 id="exercise-n1-deploy-an-ingress-controller">Exercise n.1: deploy an ingress controller</h2>
<p>There is a specific manifest we can use to install Nginx as an Ingress Controller
in a Kind cluster, so the installation step is just:</p>
<pre><code class="sh">$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/provider/kind/deploy.yaml
namespace/ingress-nginx created
&lt;snip&gt;
</code></pre>

<p>Kubernetes is pretty fast to create the objects needed but the ingress will take
a while to start. To be sure that the cluster is ready, run this command that will
wait until the Ingress Controller is ready:</p>
<pre><code class="sh">$ kubectl wait --namespace ingress-nginx \
  --for=condition=ready pod \
  --selector=app.kubernetes.io/component=controller \
  --timeout=90s
pod/ingress-nginx-controller-6b69c57f44-8xxpw condition met
</code></pre>

<p>With the ingress up and running, we can move to the next exercise.</p>
<h2 id="exercise-n2">Exercise n.2</h2>
<blockquote>
<p>Change directory into the folder <code>definitions</code> before running the commands.</p>
</blockquote>
<p>Now that we have an Ingress Controller, let's deploy an ingress resource to route
requests from outside our cluster to 2 different services.</p>
<p>We're going to deploy 2 services exposing 2 pods that will simply echo a string
in response of an HTTP request. The ingress will process the request and forward
urls ending with <code>/foo</code> to one service and urls ending with <code>/bar</code> to the other
one according to our <code>rules</code> specification:</p>
<pre><code class="sh">$ kubectl apply -f ingress-example.yaml
pod/foo-app created
service/foo-service created
pod/bar-app created
service/bar-service created
ingress.extensions/example-ingress created
</code></pre>

<p>To confirm it's working, run <code>curl</code> on localhost:</p>
<pre><code class="sh">$ curl http://localhost/foo
foo
$ curl http://localhost/bar
bar
</code></pre>

<p>If no rule is matched, Nginx will respond with its notorious 404 page:</p>
<pre><code class="sh">$ curl http://localhost/
&lt;html&gt;
&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.19.1&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
